<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tanks</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

    <h1>Tanks Information</h1>
    
    <!-- Refresh Button -->
    <button id="refreshButton">Refresh Readings</button>

    <div class="tanks-container" id="tanksContainer">
        <!-- Tanks will be populated here dynamically -->
    </div>

    <script>
        // Function to fetch new data and update the tanks
        function updateTankData() {
            $.ajax({
                url: '/get_tank_data',
                method: 'GET',
                success: function(data) {
                    var tanksContainer = $('#tanksContainer');
                    tanksContainer.empty();  // Clear the existing content

                    // Loop through the tanks and update the DOM
                    for (var tank in data) {
                        var tankData = data[tank];
                        var tankCard = `
                            <div class="tank-card">
                                <div class="tank-bar" style="height: ${tankData.fill_percentage}%"></div>
                                <h3>${tank.charAt(0).toUpperCase() + tank.slice(1)}</h3>
                                <p>Arduino Code: ${tankData.arduino_code}</p>
                                <p>Total Volume: ${tankData.total_volume} L</p>
                                <p>Full: ${tankData.full_cm} cm</p>
                                <p>Empty: ${tankData.empty_cm} cm</p>
                                <p>Fill Level: ${tankData.fill_percentage}%</p>
                            </div>
                        `;
                        tanksContainer.append(tankCard);  // Append new tank card
                    }
                },
                error: function() {
                    alert("Failed to fetch tank data.");
                }
            });
        }

        // Event listener for the Refresh button
        $('#refreshButton').click(function() {
            updateTankData();  // Update tank data on button click
        });

        // Fetch initial tank data on page load
        $(document).ready(function() {
            updateTankData();
        });
    </script>

</body>
</html>
