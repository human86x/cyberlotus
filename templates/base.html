<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberLotus Project</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 250px;
            background-color: #333;
            color: #fff;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
        }
        .sidebar h2 {
            margin-top: 0;
        }
        .sidebar a {
            display: block;
            color: #fff;
            text-decoration: none;
            padding: 10px 0;
            margin: 10px 0;
            border-bottom: 1px solid #555;
        }
        .sidebar a:hover {
            background-color: #555;
        }
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        h1, h2 {
            color: #333;
        }
        .right-sidebar {
            width: 300px;
            background-color: #f0f0f0;
            padding: 20px;
            box-sizing: border-box;
            border-left: 1px solid #ddd;
        }
        .right-sidebar h1 {
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ddd;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>CyberLotus</h2>
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('tanks') }}">Tanks</a>
        <a href="{{ url_for('pumps') }}">Pumps</a>
        <a href="{{ url_for('sequences') }}">Sequences</a>
        <a href="{{ url_for('ph') }}">pH</a>
        <a href="{{ url_for('ec') }}">EC</a>
        <a href="{{ url_for('ecosystem') }}">Ecosystem</a>
        <a href="{{ url_for('automatisation') }}">Automatisation</a>
        <a href="{{ url_for('pump_calibration') }}">Pump Calibration and Testing</a>
    </div>
    <div class="content">
        {% block content %}{% endblock %}
        <li>
            <form action="{{ url_for('emergency_stop_route') }}" method="post">
                <button type="submit" class="btn btn-danger">ðŸš¨ Emergency Stop</button>
            </form>
        </li>
        <h1>Dashboard</h1>
        <p>Welcome to the CyberLotus Project dashboard.</p>
        <button onclick="getSystemStats()">Get System Stats</button>
        <table id="systemStatsTable">
            <tr>
                <th>Sensor/Relay</th>
                <th>Value</th>
                <th>Timestamp</th>
            </tr>
        </table>
    </div>
    <div class="right-sidebar">
        <h1>System Stats</h1>
        <p>Welcome to the CyberLotus Project dashboard.</p>
    </div>
    <script>
        function getSystemStats() {
            fetch("/sys_state")
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    updateTable(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function updateTable(data) {
            const table = document.getElementById("systemStatsTable");
            while (table.rows.length > 1) {
                table.deleteRow(1);
            }

            Object.keys(data).forEach(key => {
                const row = table.insertRow();
                const cell1 = row.insertCell();
                const cell2 = row.insertCell();
                const cell3 = row.insertCell();
                cell1.innerHTML = key.toUpperCase();
                cell2.innerHTML = data[key].value || data[key].level || data[key].state;
                cell3.innerHTML = new Date(data[key].timestamp * 1000).toLocaleString();
            });
        }

        getSystemStats();
    </script>
</body>
</html>
